Cannot import torchlars
Cannot load RSCNN: No module named 'pointnet2_ops'
Cannot load PCT: No module named 'pointnet2_ops'
Cannot load PointMLP: No module named 'pointnet2_ops'
Cannot load PointNet2: No module named 'pointnet2_ops'
/content/SemNov_AML_DAAI_23-24/utils/rsmix_provider.py:157: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if len(label_batch.shape) is 1:
out-of-distribution eval - Modelnet -> SONN ..
Arguments: Namespace(local_rank=None, use_sync_bn=False, use_amp=False, script_mode='eval', config='cfgs/pn2-msg.yaml', seed=1, epochs=250, batch_size=1, num_workers=4, resume=None, apply_fix_cellphone=True, data_root='./3D_OS_release_data', checkpoints_dir='outputs', exp_name='PointNet2_CE_SR1_eval', eval_step=1, save_step=10, ckpt_path='outputs/PointNet2_CE_SR1/models/model_last.pth', src='SR1', sonn_split='main_split', sonn_h5_name='objectdataset.h5', augm_set='rw', grad_norm_clip=-1, num_points=1024, num_points_test=2048, wandb_name=None, wandb_group='md-2-sonn-augmCorr', wandb_proj='benchmark-3d-ood-cla', loss='CE', cs=False, cs_gan_lr=0.0002, cs_beta=0.1, save_feats=None, corruption=None, tar1='none', tar2='none')
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_train.h5
ModelNet40_OOD - split: train, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
SR1 train data len: 2378
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_test.h5
ModelNet40_OOD - split: test, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Src is SR1

ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {4: 0, 8: 1, 7: 2, 12: 3, 13: 4}, num samples: 1255
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {10: 0, 14: 1, 5: 2, 6: 3, 9: 2}, num samples: 788
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {0: 404, 1: 404, 2: 404, 3: 404, 11: 404}, num samples: 847
Clf - feature encoder: pn2-msg
Clf Head - num classes: 5, input dim: 1024, act: relu, dropout: 0.5
Model params count: 1.7376 M
Load weights:  <All keys matched successfully>
100% 1255/1255 [03:58<00:00,  5.27it/s]
100% 788/788 [02:27<00:00,  5.35it/s]
100% 847/847 [02:41<00:00,  5.25it/s]

################################################################################
Computing OOD metrics with MSP normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7784860557768924, Clf Bal Acc: 0.7426039016954312
SRC->TAR1:      AUROC: 0.8235, FPR95: 0.8236, AUPR_IN: 0.9004, AUPR_OUT: 0.6604
SRC->TAR2:      AUROC: 0.7872, FPR95: 0.8418, AUPR_IN: 0.8642, AUPR_OUT: 0.6406
SRC->TAR1+TAR2: AUROC: 0.8047, FPR95: 0.8330, AUPR_IN: 0.8076, AUPR_OUT: 0.7868
to spreadsheet: 0.8235368171982121,0.8236040609137056,0.9003591145641232,0.660352913667321,0.7872359440631806,0.8417945690672963,0.8641536411857772,0.6406294784470743,0.8047314107484436,0.8330275229357799,0.807623598163185,0.786802982763757
################################################################################

################################################################################
Computing OOD metrics with MLS normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7784860557768924, Clf Bal Acc: 0.7426039016954312
SRC->TAR1:      AUROC: 0.8387, FPR95: 0.8020, AUPR_IN: 0.9084, AUPR_OUT: 0.6952
SRC->TAR2:      AUROC: 0.8050, FPR95: 0.7969, AUPR_IN: 0.8681, AUPR_OUT: 0.6871
SRC->TAR1+TAR2: AUROC: 0.8213, FPR95: 0.7994, AUPR_IN: 0.8145, AUPR_OUT: 0.8148
to spreadsheet: 0.8387394584100147,0.8020304568527918,0.9083621358780787,0.6951749872107961,0.8050480486554372,0.7969303423848878,0.868117440621746,0.6871289274521976,0.8212858657114661,0.7993883792048929,0.8144733423606325,0.8147976953970557
################################################################################

################################################################################
Computing OOD metrics with entropy normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7784860557768924, Clf Bal Acc: 0.7426039016954312
SRC->TAR1:      AUROC: 0.8267, FPR95: 0.8173, AUPR_IN: 0.9015, AUPR_OUT: 0.6718
SRC->TAR2:      AUROC: 0.7921, FPR95: 0.8170, AUPR_IN: 0.8658, AUPR_OUT: 0.6633
SRC->TAR1+TAR2: AUROC: 0.8088, FPR95: 0.8171, AUPR_IN: 0.8093, AUPR_OUT: 0.7987
to spreadsheet: 0.8266901935405586,0.817258883248731,0.9015360205092211,0.6717639152826296,0.7921184212383053,0.8170011806375442,0.8657980666257943,0.6632969638751056,0.8087805353509508,0.8171253822629969,0.809317590782517,0.7986682634596372
################################################################################

################################################################################
Computing OOD metrics with distance from train features...
  0% 0/2378 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 2378/2378 [07:40<00:00,  5.16it/s]
100% 1255/1255 [03:55<00:00,  5.33it/s]
100% 788/788 [02:28<00:00,  5.31it/s]
100% 847/847 [02:38<00:00,  5.34it/s]
Euclidean distances in a non-normalized space:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7593625498007968, Clf Bal Acc: 0.6978994670837918
SRC->TAR1:      AUROC: 0.8065, FPR95: 0.8160, AUPR_IN: 0.8796, AUPR_OUT: 0.6565
SRC->TAR2:      AUROC: 0.8103, FPR95: 0.7379, AUPR_IN: 0.8641, AUPR_OUT: 0.7166
SRC->TAR1+TAR2: AUROC: 0.8085, FPR95: 0.7755, AUPR_IN: 0.7868, AUPR_OUT: 0.8134
to spreadsheet: 0.8064756203611948,0.815989847715736,0.8796498113887639,0.6565354944812514,0.8102889504555568,0.7378984651711924,0.8640635860131557,0.7165706250670794,0.8084510886119133,0.7755351681957187,0.7867726965364704,0.8134032012957293

Euclidean distances with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.21274900398406374, Clf Bal Acc: 0.2
SRC->TAR1:      AUROC: 0.8231, FPR95: 0.7970, AUPR_IN: 0.8965, AUPR_OUT: 0.6761
SRC->TAR2:      AUROC: 0.7709, FPR95: 0.8512, AUPR_IN: 0.8357, AUPR_OUT: 0.6291
SRC->TAR1+TAR2: AUROC: 0.7961, FPR95: 0.8251, AUPR_IN: 0.7771, AUPR_OUT: 0.7875
to spreadsheet: 0.8231050417618866,0.7969543147208121,0.8964620766760477,0.6760590267603069,0.7709168050348782,0.8512396694214877,0.835666489994459,0.6291119527329617,0.7960693007785372,0.8250764525993883,0.7770787940242938,0.7875327168677972

Cosine similarities on the hypersphere:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7673306772908367, Clf Bal Acc: 0.7298565420795201
SRC->TAR1:      AUROC: 0.8264, FPR95: 0.7970, AUPR_IN: 0.8927, AUPR_OUT: 0.6951
SRC->TAR2:      AUROC: 0.7961, FPR95: 0.7910, AUPR_IN: 0.8469, AUPR_OUT: 0.6909
SRC->TAR1+TAR2: AUROC: 0.8107, FPR95: 0.7939, AUPR_IN: 0.7810, AUPR_OUT: 0.8151
to spreadsheet: 0.8263903775759904,0.7969543147208121,0.8926505340016457,0.6951048902085354,0.7960639143543888,0.7910271546635183,0.8468517551175626,0.6908779370687447,0.8106799712465125,0.7938837920489297,0.7810328847245909,0.8150946401977528

Cosine similarities with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.21274900398406374, Clf Bal Acc: 0.2
SRC->TAR1:      AUROC: 0.7486, FPR95: 0.8363, AUPR_IN: 0.8421, AUPR_OUT: 0.6108
SRC->TAR2:      AUROC: 0.6697, FPR95: 0.9268, AUPR_IN: 0.7693, AUPR_OUT: 0.5205
SRC->TAR1+TAR2: AUROC: 0.7078, FPR95: 0.8832, AUPR_IN: 0.6885, AUPR_OUT: 0.7201
to spreadsheet: 0.7486460250369082,0.8362944162436549,0.8421159626203932,0.6107757046117548,0.6697418119728876,0.9268004722550177,0.7693435725193529,0.520549644793026,0.7077702645077184,0.8831804281345565,0.688485462410116,0.7200713035109749
################################################################################

################################################################################
Computing OOD metrics with ODIN normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [09:12<00:00,  2.27it/s]
100% 788/788 [05:49<00:00,  2.26it/s]
100% 847/847 [06:13<00:00,  2.27it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.8190, FPR95: 0.7944, AUPR_IN: 0.8953, AUPR_OUT: 0.6713
SRC->TAR2:      AUROC: 0.8115, FPR95: 0.7497, AUPR_IN: 0.8725, AUPR_OUT: 0.6971
SRC->TAR1+TAR2: AUROC: 0.8151, FPR95: 0.7713, AUPR_IN: 0.8084, AUPR_OUT: 0.8107
to spreadsheet: 0.8189627277691265,0.7944162436548223,0.8953090373898401,0.6713223614658316,0.8115048660141018,0.7497048406139315,0.8725205297855585,0.6970784870721919,0.8150992360831901,0.7712538226299694,0.8083961885558367,0.8107171682539247
################################################################################

################################################################################
Computing OOD metrics with Energy normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [04:08<00:00,  5.04it/s]
100% 788/788 [02:37<00:00,  5.01it/s]
100% 847/847 [02:49<00:00,  5.01it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.8427, FPR95: 0.7855, AUPR_IN: 0.9125, AUPR_OUT: 0.6883
SRC->TAR2:      AUROC: 0.8133, FPR95: 0.7780, AUPR_IN: 0.8752, AUPR_OUT: 0.6851
SRC->TAR1+TAR2: AUROC: 0.8275, FPR95: 0.7817, AUPR_IN: 0.8240, AUPR_OUT: 0.8124
to spreadsheet: 0.8427447570125589,0.7855329949238579,0.9125456947482622,0.6883234446076241,0.8133068669830712,0.7780401416765053,0.8752288125219878,0.685077036147812,0.8274946696394849,0.781651376146789,0.8240114754378649,0.8124402537866223
################################################################################

################################################################################
Computing OOD metrics with GradNorm normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [04:30<00:00,  4.64it/s]
100% 788/788 [02:49<00:00,  4.66it/s]
100% 847/847 [03:02<00:00,  4.65it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.7536, FPR95: 0.8185, AUPR_IN: 0.8318, AUPR_OUT: 0.6179
SRC->TAR2:      AUROC: 0.7387, FPR95: 0.8158, AUPR_IN: 0.7977, AUPR_OUT: 0.6270
SRC->TAR1+TAR2: AUROC: 0.7459, FPR95: 0.8171, AUPR_IN: 0.6971, AUPR_OUT: 0.7633
to spreadsheet: 0.75361801524865,0.8185279187817259,0.8317984788742021,0.6178843917273764,0.7386595295324017,0.8158205430932703,0.7977207291221593,0.6269603228299027,0.7458688792231685,0.8171253822629969,0.6970671241093693,0.7632511789260019
################################################################################

################################################################################
Building React validation loader...
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_test.h5
ModelNet40_OOD - split: test, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
React Val - SR1 data len: 340
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 340/340 [01:07<00:00,  5.02it/s]
t = 1.2164
Computing OOD metrics with React (+Energy) normality score, ID-dependent threshold (=1.2164)...
React - using SR1 test to compute threshold
100% 1255/1255 [04:12<00:00,  4.96it/s]
100% 788/788 [02:37<00:00,  5.01it/s]
100% 847/847 [03:04<00:00,  4.60it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.8436, FPR95: 0.7614, AUPR_IN: 0.9076, AUPR_OUT: 0.7076
SRC->TAR2:      AUROC: 0.8220, FPR95: 0.7615, AUPR_IN: 0.8866, AUPR_OUT: 0.7019
SRC->TAR1+TAR2: AUROC: 0.8324, FPR95: 0.7615, AUPR_IN: 0.8297, AUPR_OUT: 0.8246
to spreadsheet: 0.843628531559043,0.7614213197969543,0.9076319071689452,0.7076007439031228,0.8219570360823529,0.7615112160566706,0.8865628107396247,0.7019205331870673,0.832401769070507,0.7614678899082569,0.8296659096535343,0.8246098205254622
################################################################################
