Cannot import torchlars
Cannot load RSCNN: No module named 'pointnet2_ops'
Cannot load PCT: No module named 'pointnet2_ops'
Cannot load PointMLP: No module named 'pointnet2_ops'
Cannot load PointNet2: No module named 'pointnet2_ops'
/content/SemNov_AML_DAAI_23-24/utils/rsmix_provider.py:157: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if len(label_batch.shape) is 1:
out-of-distribution eval - Modelnet -> SONN ..
Arguments: Namespace(local_rank=None, use_sync_bn=False, use_amp=False, script_mode='eval', config='cfgs/dgcnn-cla.yaml', seed=1, epochs=250, batch_size=1, num_workers=4, resume=None, apply_fix_cellphone=True, data_root='./3D_OS_release_data', checkpoints_dir='outputs', exp_name='DGCNN_CE_SR1_eval', eval_step=1, save_step=10, ckpt_path='outputs/DGCNN_CE_SR1/models/model_last.pth', src='SR1', sonn_split='main_split', sonn_h5_name='objectdataset.h5', augm_set='rw', grad_norm_clip=-1, num_points=1024, num_points_test=2048, wandb_name=None, wandb_group='md-2-sonn-augmCorr', wandb_proj='benchmark-3d-ood-cla', loss='CE', cs=False, cs_gan_lr=0.0002, cs_beta=0.1, save_feats='feats/DGCNN_CE_SR1.pt', save_tensors='resources/DGCNN_CE_SR1', corruption=None, tar1='none', tar2='none')
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_train.h5
ModelNet40_OOD - split: train, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
SR1 train data len: 2378
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_test.h5
ModelNet40_OOD - split: test, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Src is SR1

ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {4: 0, 8: 1, 7: 2, 12: 3, 13: 4}, num samples: 1255
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {10: 0, 14: 1, 5: 2, 6: 3, 9: 2}, num samples: 788
ScanObject - num_points: 2048, sonn_split: main_split, h5_suffix: objectdataset.h5, split: all, class_choice: {0: 404, 1: 404, 2: 404, 3: 404, 11: 404}, num samples: 847
dgcnn k: 20
dgcnn emb_dims: 1024
Clf - feature encoder: DGCNN
Clf Head - num classes: 5, input dim: 2048, act: leakyrelu, dropout: 0.5
Model params count: 1.8003 M
Load weights:  <All keys matched successfully>
100% 1255/1255 [00:25<00:00, 48.52it/s]
100% 788/788 [00:15<00:00, 50.41it/s]
100% 847/847 [00:16<00:00, 49.92it/s]
Logits saved to resources/DGCNN_CE_SR1

################################################################################
Computing OOD metrics with MSP normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7243027888446215, Clf Bal Acc: 0.7098800108312664
SRC->TAR1:      AUROC: 0.7278, FPR95: 0.9112, AUPR_IN: 0.8415, AUPR_OUT: 0.5397
SRC->TAR2:      AUROC: 0.7270, FPR95: 0.8926, AUPR_IN: 0.8324, AUPR_OUT: 0.5622
SRC->TAR1+TAR2: AUROC: 0.7274, FPR95: 0.9015, AUPR_IN: 0.7440, AUPR_OUT: 0.7102
to spreadsheet: 0.7277868222541306,0.9111675126903553,0.8415098396129099,0.5397056094959579,0.726955225144287,0.8925619834710744,0.8324478931731575,0.5622370621114305,0.7273560193476858,0.9015290519877676,0.7440213332048763,0.710248314258086
################################################################################

################################################################################
Computing OOD metrics with MLS normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7243027888446215, Clf Bal Acc: 0.7098800108312664
SRC->TAR1:      AUROC: 0.6948, FPR95: 0.9137, AUPR_IN: 0.8256, AUPR_OUT: 0.5062
SRC->TAR2:      AUROC: 0.7134, FPR95: 0.8749, AUPR_IN: 0.8253, AUPR_OUT: 0.5623
SRC->TAR1+TAR2: AUROC: 0.7045, FPR95: 0.8936, AUPR_IN: 0.7293, AUPR_OUT: 0.6966
to spreadsheet: 0.6948338625194653,0.9137055837563451,0.8255544459512449,0.5061919472643123,0.7134286937256876,0.8748524203069658,0.82533653115017,0.5623209507422089,0.7044667811932698,0.8935779816513761,0.7293171090416669,0.6965622872559215
################################################################################

################################################################################
Computing OOD metrics with entropy normality score...
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7243027888446215, Clf Bal Acc: 0.7098800108312664
SRC->TAR1:      AUROC: 0.7238, FPR95: 0.9213, AUPR_IN: 0.8403, AUPR_OUT: 0.5330
SRC->TAR2:      AUROC: 0.7259, FPR95: 0.8985, AUPR_IN: 0.8325, AUPR_OUT: 0.5653
SRC->TAR1+TAR2: AUROC: 0.7249, FPR95: 0.9095, AUPR_IN: 0.7436, AUPR_OUT: 0.7087
to spreadsheet: 0.7237759621412826,0.9213197969543148,0.8402590698768121,0.5329537847413177,0.7259331034774714,0.898465171192444,0.8324994648587559,0.5653369821590519,0.7248934537081033,0.909480122324159,0.7435625281281988,0.7087075582495126
################################################################################

################################################################################
Computing OOD metrics with distance from train features...
  0% 0/2378 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 2378/2378 [00:15<00:00, 152.13it/s]
100% 1255/1255 [00:25<00:00, 49.22it/s]
100% 788/788 [00:16<00:00, 48.55it/s]
100% 847/847 [00:17<00:00, 48.12it/s]
Features saved to feats/DGCNN_CE_SR1.pt
Euclidean distances in a non-normalized space:
Euclid L2 distances saved to resources/DGCNN_CE_SR1
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7298804780876494, Clf Bal Acc: 0.7091035223956461
SRC->TAR1:      AUROC: 0.6273, FPR95: 0.9162, AUPR_IN: 0.7473, AUPR_OUT: 0.4642
SRC->TAR2:      AUROC: 0.7409, FPR95: 0.7957, AUPR_IN: 0.8104, AUPR_OUT: 0.6143
SRC->TAR1+TAR2: AUROC: 0.6861, FPR95: 0.8538, AUPR_IN: 0.6477, AUPR_OUT: 0.7014
to spreadsheet: 0.6272584787752543,0.916243654822335,0.7472869271584004,0.46419873903328257,0.7408721665874871,0.7957497048406139,0.8103795216161764,0.6143223822180544,0.6861152332565761,0.8538226299694189,0.6477269762531888,0.7014368949743408

Euclidean distances with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.21274900398406374, Clf Bal Acc: 0.2
SRC->TAR1:      AUROC: 0.5991, FPR95: 0.9416, AUPR_IN: 0.7065, AUPR_OUT: 0.4438
SRC->TAR2:      AUROC: 0.6807, FPR95: 0.8536, AUPR_IN: 0.7342, AUPR_OUT: 0.5620
SRC->TAR1+TAR2: AUROC: 0.6414, FPR95: 0.8960, AUPR_IN: 0.5649, AUPR_OUT: 0.6700
to spreadsheet: 0.5990838675753837,0.9416243654822335,0.7065081108087558,0.4437748828332854,0.6807405560755796,0.8536009445100354,0.7342464305538992,0.5620420763014071,0.6413855282234975,0.8960244648318043,0.564858898587193,0.6699694986702505

Cosine similarities on the hypersphere:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.7274900398406374, Clf Bal Acc: 0.7136531686432895
SRC->TAR1:      AUROC: 0.6528, FPR95: 0.9454, AUPR_IN: 0.7856, AUPR_OUT: 0.4756
SRC->TAR2:      AUROC: 0.7216, FPR95: 0.8902, AUPR_IN: 0.8130, AUPR_OUT: 0.5802
SRC->TAR1+TAR2: AUROC: 0.6884, FPR95: 0.9168, AUPR_IN: 0.6845, AUPR_OUT: 0.6922
to spreadsheet: 0.6527959229073553,0.9454314720812182,0.7856286544758688,0.4755971660900844,0.7215614519489928,0.8902007083825265,0.8130303049036084,0.5802326706698978,0.6884194110408519,0.9168195718654434,0.6844988582512838,0.6922253920007054

Cosine similarities with prototypes:
AUROC - Src label: 1, Tar label: 0
Src Test - Clf Acc: 0.21274900398406374, Clf Bal Acc: 0.2
SRC->TAR1:      AUROC: 0.5701, FPR95: 0.9201, AUPR_IN: 0.6964, AUPR_OUT: 0.4384
SRC->TAR2:      AUROC: 0.6321, FPR95: 0.9044, AUPR_IN: 0.7073, AUPR_OUT: 0.5086
SRC->TAR1+TAR2: AUROC: 0.6022, FPR95: 0.9119, AUPR_IN: 0.5454, AUPR_OUT: 0.6426
to spreadsheet: 0.570083119299452,0.9200507614213198,0.6963849315940058,0.43837416893312997,0.6321330968922422,0.9043683589138135,0.7072869066514672,0.5085778689711686,0.6022276642664814,0.9119266055045872,0.5454298996470973,0.6426289769920733
################################################################################

################################################################################
Computing OOD metrics with ODIN normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [01:10<00:00, 17.85it/s]
100% 788/788 [00:43<00:00, 18.07it/s]
100% 847/847 [00:46<00:00, 18.04it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6952, FPR95: 0.9099, AUPR_IN: 0.8260, AUPR_OUT: 0.5062
SRC->TAR2:      AUROC: 0.7134, FPR95: 0.8749, AUPR_IN: 0.8253, AUPR_OUT: 0.5622
SRC->TAR1+TAR2: AUROC: 0.7046, FPR95: 0.8917, AUPR_IN: 0.7297, AUPR_OUT: 0.6965
to spreadsheet: 0.6951908103626105,0.9098984771573604,0.8259918371939978,0.5062451208650589,0.7134404530637779,0.8748524203069658,0.8253498274903259,0.5622234243623948,0.7046449066120838,0.8917431192660551,0.7296840623317786,0.6965449554532079
################################################################################

################################################################################
Computing OOD metrics with Energy normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [00:28<00:00, 44.43it/s]
100% 788/788 [00:17<00:00, 44.57it/s]
100% 847/847 [00:18<00:00, 44.69it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6927, FPR95: 0.9124, AUPR_IN: 0.8245, AUPR_OUT: 0.5059
SRC->TAR2:      AUROC: 0.7129, FPR95: 0.8642, AUPR_IN: 0.8249, AUPR_OUT: 0.5658
SRC->TAR1+TAR2: AUROC: 0.7031, FPR95: 0.8875, AUPR_IN: 0.7283, AUPR_OUT: 0.6976
to spreadsheet: 0.6926593119906163,0.9124365482233503,0.8245116616261962,0.505898570220557,0.7128962308969553,0.8642266824085005,0.8248616524245332,0.5657572316133328,0.7031429023965301,0.8874617737003058,0.7283316015986406,0.6975824388554545
################################################################################

################################################################################
Computing OOD metrics with GradNorm normality score...
  0% 0/1255 [00:00<?, ?it/s]/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 1255/1255 [00:42<00:00, 29.22it/s]
100% 788/788 [00:27<00:00, 29.09it/s]
100% 847/847 [00:29<00:00, 28.98it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6958, FPR95: 0.9137, AUPR_IN: 0.8175, AUPR_OUT: 0.5082
SRC->TAR2:      AUROC: 0.6771, FPR95: 0.9162, AUPR_IN: 0.7999, AUPR_OUT: 0.5110
SRC->TAR1+TAR2: AUROC: 0.6861, FPR95: 0.9150, AUPR_IN: 0.7021, AUPR_OUT: 0.6746
to spreadsheet: 0.6958207778024956,0.9137055837563451,0.8174814947256409,0.5081770565891985,0.6770532980239607,0.9161747343565525,0.799922300423829,0.511041983548814,0.6860984197765513,0.9149847094801223,0.702089464076854,0.6746279282685912
################################################################################

################################################################################
Building React validation loader...
ModelNet40_OOD - Reading data from h5py file: ./3D_OS_release_data/modelnet40_normal_resampled/ood_sets_cache/SR1_test.h5
ModelNet40_OOD - split: test, categories: {'chair': 0, 'bookshelf': 1, 'door': 2, 'sink': 3, 'sofa': 4}
React Val - SR1 data len: 340
/usr/local/lib/python3.10/dist-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
100% 340/340 [00:02<00:00, 114.24it/s]
t = 2.0652
Computing OOD metrics with React (+Energy) normality score, ID-dependent threshold (=2.0652)...
React - using SR1 test to compute threshold
100% 1255/1255 [00:27<00:00, 45.02it/s]
100% 788/788 [00:17<00:00, 44.21it/s]
100% 847/847 [00:18<00:00, 44.90it/s]
AUROC - Src label: 1, Tar label: 0
SRC->TAR1:      AUROC: 0.6751, FPR95: 0.9124, AUPR_IN: 0.8015, AUPR_OUT: 0.4982
SRC->TAR2:      AUROC: 0.7130, FPR95: 0.8583, AUPR_IN: 0.8150, AUPR_OUT: 0.5749
SRC->TAR1+TAR2: AUROC: 0.6947, FPR95: 0.8844, AUPR_IN: 0.6997, AUPR_OUT: 0.6984
to spreadsheet: 0.6750905009404008,0.9124365482233503,0.8014830841743994,0.49819142023052365,0.7130091205426229,0.8583234946871311,0.8149863660733583,0.574916028546858,0.6947339693214908,0.8844036697247707,0.6996838545147014,0.6984021577589343
################################################################################